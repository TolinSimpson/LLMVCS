// Pong
// Controls:
// - Left paddle: W/S
// - Right paddle: Up/Down
// - Restart: R
//
// Labels are supported: define with `:name` and jump with `@name`.
//
// Modules:
// - 0 = llmvcc-ops
// - 2 = graphics-ops
// - 4 = input-ops

2.0(800, 600, "PONG - VCS-JS")

:reset
0.11("p1y", 250)
0.11("p2y", 250)
0.11("p1score", 0)
0.11("p2score", 0)
0.11("bx", 392)
0.11("by", 292)
0.11("bvx", 5)
0.11("bvy", 3)

:loop
// Exit if window closed
2.7()
0.6(@exit, $result)

// Restart key (R=82)
4.1(82)
0.5(@reset, $result)

// --- Input (left paddle W/S) ---
4.0(87)            // W
0.6(@p1_down, $result)
0.18($p1y, 8)
0.11("p1y", $result)

:p1_down
4.0(83)            // S
0.6(@p2_up, $result)
0.17($p1y, 8)
0.11("p1y", $result)

// --- Input (right paddle Up/Down) ---
:p2_up
4.0(38)            // Up
0.6(@p2_down, $result)
0.18($p2y, 8)
0.11("p2y", $result)

:p2_down
4.0(40)            // Down
0.6(@clamp_p1_top, $result)
0.17($p2y, 8)
0.11("p2y", $result)

// --- Clamp paddles to screen (0..500) ---
:clamp_p1_top
0.23($p1y, 0)
0.6(@clamp_p1_bot, $result)
0.11("p1y", 0)

:clamp_p1_bot
0.22($p1y, 500)
0.6(@clamp_p2_top, $result)
0.11("p1y", 500)

:clamp_p2_top
0.23($p2y, 0)
0.6(@clamp_p2_bot, $result)
0.11("p2y", 0)

:clamp_p2_bot
0.22($p2y, 500)
0.6(@move_ball, $result)
0.11("p2y", 500)

// --- Ball movement ---
:move_ball
0.17($bx, $bvx)
0.11("bx", $result)
0.17($by, $bvy)
0.11("by", $result)

// --- Wall collisions (top/bottom) ---
0.23($by, 0)
0.6(@wall_bottom, $result)
0.15($bvy, -1)
0.11("bvy", $result)
0.11("by", 0)

:wall_bottom
0.22($by, 585)
0.6(@paddle1, $result)
0.15($bvy, -1)
0.11("bvy", $result)
0.11("by", 585)

// --- Paddle collisions ---
:paddle1
0.23($bx, 55)
0.6(@paddle2, $result)
0.24($by, $p1y)
0.6(@paddle2, $result)
0.17($p1y, 100)
0.25($by, $result)
0.6(@paddle2, $result)
0.15($bvx, -1)
0.11("bvx", $result)
0.11("bx", 55)

:paddle2
0.22($bx, 730)
0.6(@score_left, $result)
0.24($by, $p2y)
0.6(@score_left, $result)
0.17($p2y, 100)
0.25($by, $result)
0.6(@score_left, $result)
0.15($bvx, -1)
0.11("bvx", $result)
0.11("bx", 730)

// --- Scoring ---
:score_left
0.23($bx, 0)
0.6(@score_right, $result)
0.17($p2score, 1)
0.11("p2score", $result)
0.11("bx", 392)
0.11("by", 292)
0.11("bvx", 5)
0.11("bvy", 3)
0.4(@render)

:score_right
0.22($bx, 800)
0.6(@render, $result)
0.17($p1score, 1)
0.11("p1score", $result)
0.11("bx", 392)
0.11("by", 292)
0.11("bvx", -5)
0.11("bvy", 3)

// --- Render ---
:render
2.2(0, 0, 0)
2.3(30, $p1y, 15, 100, 255, 255, 255)
2.3(755, $p2y, 15, 100, 255, 255, 255)
2.3($bx, $by, 15, 15, 255, 255, 255)
2.5("P1", 120, 30, 18, 200, 200, 200)
2.5($p1score, 155, 30, 18, 200, 200, 200)
2.5("P2", 610, 30, 18, 200, 200, 200)
2.5($p2score, 645, 30, 18, 200, 200, 200)
2.6()
2.10(16)
0.4(@loop)

:exit
2.1()
0.1()

